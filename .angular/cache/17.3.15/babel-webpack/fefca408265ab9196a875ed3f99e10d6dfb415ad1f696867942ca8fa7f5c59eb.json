{"ast":null,"code":"import _asyncToGenerator from \"/home/nigel/work/safe-space/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { DOCUMENT } from '@angular/common';\nimport { darkStyle } from './map-dark-style';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../providers/conference-data\";\nimport * as i2 from \"@ionic/angular\";\nconst _c0 = [\"mapCanvas\"];\nexport class MapPage {\n  doc;\n  confData;\n  platform;\n  mapElement;\n  constructor(doc, confData, platform) {\n    this.doc = doc;\n    this.confData = confData;\n    this.platform = platform;\n  }\n  ngAfterViewInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const appEl = _this.doc.querySelector('ion-app');\n      let isDark = false;\n      let style = [];\n      if (appEl.classList.contains('dark-theme')) {\n        style = darkStyle;\n      }\n      const googleMaps = yield getGoogleMaps('AIzaSyB8pf6ZdFQj5qw7rc_HSGrhUwQKfIe9ICw');\n      let map;\n      _this.confData.getMap().subscribe(mapData => {\n        const mapEle = _this.mapElement.nativeElement;\n        map = new googleMaps.Map(mapEle, {\n          center: mapData.find(d => d.center),\n          zoom: 16,\n          styles: style\n        });\n        mapData.forEach(markerData => {\n          const infoWindow = new googleMaps.InfoWindow({\n            content: `<h5>${markerData.name}</h5>`\n          });\n          const marker = new googleMaps.Marker({\n            position: markerData,\n            map,\n            title: markerData.name\n          });\n          marker.addListener('click', () => {\n            infoWindow.open(map, marker);\n          });\n        });\n        googleMaps.event.addListenerOnce(map, 'idle', () => {\n          mapEle.classList.add('show-map');\n        });\n      });\n      const observer = new MutationObserver(mutations => {\n        mutations.forEach(mutation => {\n          if (mutation.attributeName === 'class') {\n            const el = mutation.target;\n            isDark = el.classList.contains('dark-theme');\n            if (map && isDark) {\n              map.setOptions({\n                styles: darkStyle\n              });\n            } else if (map) {\n              map.setOptions({\n                styles: []\n              });\n            }\n          }\n        });\n      });\n      observer.observe(appEl, {\n        attributes: true\n      });\n    })();\n  }\n  static ɵfac = function MapPage_Factory(t) {\n    return new (t || MapPage)(i0.ɵɵdirectiveInject(DOCUMENT), i0.ɵɵdirectiveInject(i1.ConferenceData), i0.ɵɵdirectiveInject(i2.Platform));\n  };\n  static ɵcmp = (() => /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MapPage,\n    selectors: [[\"page-map\"]],\n    viewQuery: function MapPage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.mapElement = _t.first);\n      }\n    },\n    decls: 9,\n    vars: 0,\n    consts: [[\"mapCanvas\", \"\"], [\"slot\", \"start\"], [1, \"map-canvas\"]],\n    template: function MapPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 1);\n        i0.ɵɵelement(3, \"ion-menu-button\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Map\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(6, \"ion-content\");\n        i0.ɵɵelement(7, \"div\", 2, 0);\n        i0.ɵɵelementEnd();\n      }\n    },\n    dependencies: [i2.IonButtons, i2.IonContent, i2.IonHeader, i2.IonMenuButton, i2.IonTitle, i2.IonToolbar],\n    styles: [\".map-canvas[_ngcontent-%COMP%] {\\n  position: absolute;\\n  height: 100%;\\n  width: 100%;\\n  background-color: transparent;\\n  opacity: 0;\\n  transition: opacity 150ms ease-in;\\n}\\n\\n.show-map[_ngcontent-%COMP%] {\\n  opacity: 1;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvbWFwL21hcC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0Usa0JBQUE7RUFFQSxZQUFBO0VBQ0EsV0FBQTtFQUVBLDZCQUFBO0VBRUEsVUFBQTtFQUNBLGlDQUFBO0FBRkY7O0FBS0E7RUFDRSxVQUFBO0FBRkYiLCJzb3VyY2VzQ29udGVudCI6WyIubWFwLWNhbnZhcyB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcblxuICBoZWlnaHQ6IDEwMCU7XG4gIHdpZHRoOiAxMDAlO1xuXG4gIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuXG4gIG9wYWNpdHk6IDA7XG4gIHRyYW5zaXRpb246IG9wYWNpdHkgMTUwbXMgZWFzZS1pbjtcbn1cblxuLnNob3ctbWFwIHtcbiAgb3BhY2l0eTogMTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n  }))();\n}\nfunction getGoogleMaps(apiKey) {\n  const win = window;\n  const googleModule = win.google;\n  if (googleModule && googleModule.maps) {\n    return Promise.resolve(googleModule.maps);\n  }\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&v=3.31`;\n    script.async = true;\n    script.defer = true;\n    document.body.appendChild(script);\n    script.onload = () => {\n      const googleModule2 = win.google;\n      if (googleModule2 && googleModule2.maps) {\n        resolve(googleModule2.maps);\n      } else {\n        reject('google maps not available');\n      }\n    };\n  });\n}","map":{"version":3,"names":["DOCUMENT","darkStyle","MapPage","doc","confData","platform","mapElement","constructor","ngAfterViewInit","_this","_asyncToGenerator","appEl","querySelector","isDark","style","classList","contains","googleMaps","getGoogleMaps","map","getMap","subscribe","mapData","mapEle","nativeElement","Map","center","find","d","zoom","styles","forEach","markerData","infoWindow","InfoWindow","content","name","marker","Marker","position","title","addListener","open","event","addListenerOnce","add","observer","MutationObserver","mutations","mutation","attributeName","el","target","setOptions","observe","attributes","i0","ɵɵdirectiveInject","i1","ConferenceData","i2","Platform","selectors","viewQuery","MapPage_Query","rf","ctx","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","ɵɵtext","apiKey","win","window","googleModule","google","maps","Promise","resolve","reject","script","document","createElement","src","async","defer","body","appendChild","onload","googleModule2"],"sources":["/home/nigel/work/safe-space/src/app/pages/map/map.ts","/home/nigel/work/safe-space/src/app/pages/map/map.html"],"sourcesContent":["import { Component, ElementRef, Inject, ViewChild, AfterViewInit } from '@angular/core';\nimport { ConferenceData } from '../../providers/conference-data';\nimport { Platform } from '@ionic/angular';\nimport { DOCUMENT} from '@angular/common';\n\nimport { darkStyle } from './map-dark-style';\n\n@Component({\n  selector: 'page-map',\n  templateUrl: 'map.html',\n  styleUrls: ['./map.scss']\n})\nexport class MapPage implements AfterViewInit {\n  @ViewChild('mapCanvas', { static: true }) mapElement: ElementRef;\n\n  constructor(\n    @Inject(DOCUMENT) private doc: Document,\n    public confData: ConferenceData,\n    public platform: Platform) {}\n\n  async ngAfterViewInit() {\n    const appEl = this.doc.querySelector('ion-app');\n    let isDark = false;\n    let style = [];\n    if (appEl.classList.contains('dark-theme')) {\n      style = darkStyle;\n    }\n\n    const googleMaps = await getGoogleMaps(\n      'AIzaSyB8pf6ZdFQj5qw7rc_HSGrhUwQKfIe9ICw'\n    );\n\n    let map;\n\n    this.confData.getMap().subscribe((mapData: any) => {\n      const mapEle = this.mapElement.nativeElement;\n\n      map = new googleMaps.Map(mapEle, {\n        center: mapData.find((d: any) => d.center),\n        zoom: 16,\n        styles: style\n      });\n\n      mapData.forEach((markerData: any) => {\n        const infoWindow = new googleMaps.InfoWindow({\n          content: `<h5>${markerData.name}</h5>`\n        });\n\n        const marker = new googleMaps.Marker({\n          position: markerData,\n          map,\n          title: markerData.name\n        });\n\n        marker.addListener('click', () => {\n          infoWindow.open(map, marker);\n        });\n      });\n\n      googleMaps.event.addListenerOnce(map, 'idle', () => {\n        mapEle.classList.add('show-map');\n      });\n    });\n\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.attributeName === 'class') {\n          const el = mutation.target as HTMLElement;\n          isDark = el.classList.contains('dark-theme');\n          if (map && isDark) {\n            map.setOptions({styles: darkStyle});\n          } else if (map) {\n            map.setOptions({styles: []});\n          }\n        }\n      });\n    });\n    observer.observe(appEl, {\n      attributes: true\n    });\n  }\n}\n\nfunction getGoogleMaps(apiKey: string): Promise<any> {\n  const win = window as any;\n  const googleModule = win.google;\n  if (googleModule && googleModule.maps) {\n    return Promise.resolve(googleModule.maps);\n  }\n\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&v=3.31`;\n    script.async = true;\n    script.defer = true;\n    document.body.appendChild(script);\n    script.onload = () => {\n      const googleModule2 = win.google;\n      if (googleModule2 && googleModule2.maps) {\n        resolve(googleModule2.maps);\n      } else {\n        reject('google maps not available');\n      }\n    };\n  });\n}\n\n","<ion-header>\n  <ion-toolbar>\n    <ion-buttons slot=\"start\">\n      <ion-menu-button></ion-menu-button>\n    </ion-buttons>\n    <ion-title>Map</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content>\n  <div #mapCanvas class=\"map-canvas\"></div>\n</ion-content>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}